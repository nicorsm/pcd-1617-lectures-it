# PCD Module 2.6

**Formalismi visuali**

## Formalismi visuali

Servono per descrivere rigorosamente modelli di sistemi concorrenti per mezzo di un qualche tipo di diagramma visuale. Possono rappresentare, ad esempio, le dinamiche di un sistema o la struttura di task e dipendenze.

Sono utili sia per la specifica dei requisiti che per l'analisi e la progettazione. L'analisi è formale quando è formalmente specificata.

In questo capitolo:

- Reti di Petri
- Diagrammi a stati
- Diagrammi di attività

## Reti di Petri

- Modello formale e astratto del flusso di informazioni; descrive ed analizza i flussi di informazioni e controllo nel sistema, in particolare nei sistemi che esibiscono attività concorrenti e asincrone.
- Utilizzo principale: modellazione di sistemi ad eventi in cui è possibile che alcuni eventi possano occorrere concorrentemente, ma sono presenti vincoli sulla concorrenza, precedenza o frequenza di queste occorrenze.

### Grafo delle reti di Petri

- Grafo bipartito che rappresenta una rete di Petri,
	- due tipi di nodi: **posti** (cerchi), **transizioni** (barre)
	- connnessi da archi direzionati
- Modella le proprietà statiche del sistema

### Token e marcatori

- Una rete di Petri ha proprietà dinamiche che risultano dalla sua esecuzione
	- l'esecuzione di una rete è controllata dalla posizione e dal movimento di marcatori chiamati **token**, indicati da punti neri.
	- una rete con token è chiamata **rete di Petri contrassegnata**

### Regole di esecuzione

- I token sono mossi dall'esecuzione di transizioni nella rete
- Una transizione deve essere _abilitata_ affinchè venga eseguita
- Una transizione è abilitata quando tutti i suoi _posti di input_ hanno un token all'interno
- Le transizioni vengono eseguite rimuovendo i token di abilitazione dai relativi posti di input e generando nuovi token che sono depositati nel posto di output della transizione. (vedi figure, si capisce di piu)

### Marcatori

La distribuzione dei token in una rete di Petri marcata definisce lo stato della rete ed è chiamata marcatore. Il marcatore può cambiare come risultato dell'esecuzione di una transizione. Transizioni diverse possono essere eseguite con risultati di marcatori diversi (non-determinismo inerente).

(vedi figure)

### Transizioni di demarcazione

- transizione **sorgente**: senza alcun posto di input, produce solo token ($|| \rightarrow \circle$)
- transizione **rubinetto**: senza alcun posto di output, consuma solamente token ($\circle \rightarrow ||$)

### Archi pesati

- Una variante consiste nell'uso di archi pesati
	- una transizione è abilitata se ogni posto di input $p$ di $t$ è marcato con almeno $w(p,t)$ token, ovvero con il peso dell'arco da $p$ a $t$.
	- l'esecuzione di una transizione abilitata $t$ rimuove $w(p,t)$ token da ogni posto di input $p$ di $t$ e aggiunge $w$ token ad ogni posto di output $p$ di $t$, con $w(t,p)$ peso dell'arco da $t$ a $p$.

Esempio: reazione H2O

### Modellazione con reti di Petri

Le RdP possono essere usate per modellare naturalmente sistemi concorrenti in termini di **eventi**, **condizioni** e le **relazioni** tra di essi. Ovvero: in un sistema, in un qualsiasi momento, ci saranno certe condizioni. Il fatto che tali condizioni siano mantenute può causare l'occorrenza di certi eventi. Le occorrenze possono cambiare lo stato del sistema, causando alcune delle condizioni precedenti per cessare il mantenimento e causando altre condizioni ad essere mantenute ???. Esecuzione di una transizione = occorrenza di un evento, atomico.

### Modellazione di concorrenza e parallelismo

Le RdP sono ideali per modellare sistemi a controllo distribuito con multipli processi che occorrono concorrentemente. **Vedi img su slide**

### Modellare conflitti ed eventi concorrenti

- **eventi di conflitto**: due eventi sono in conflitto se uno dei due può accadere ma non entrambi.
- **eventi concorrenti**: due eventi sono concorrenti se entrambi gli eventi possono accadere in qualsiasi ordine senza conflitti.
- Una situazione dove conflitto e concorrenza sono mischiati è chiamata **confusione**.

### Asincronia e località

In una RdP non ci sono inerenti misure di tempo o di flusso di tempo. L'unica importante proprietà del tempo, da un punto di vista logico, è definire un **ordinamento parziale** di occorrenze degli eventi. Eventi che hanno bisogno di non essere vincolati in termini di ordine di occorrenza non sono vincolati.

**Località**: in un sistema complesso composto da sottoparti operative asincronicamente e indipendente, ogni parte può essere modellata tramite RdP. L'abilitazione e l'esecuzione di transizioni sono affette da, e affliggono solo, cambiamenti locali nella marcatura di una RdP.

### Non-determinismo

Una RdP è vista come una sequenza di eventi discreti il cui ordine di occorrenza è uno dei possibili consentiti dalla struttura base. Se in un qualsiasi momento più di una transizione è abilitata, allora qualsiasi delle diverse transizioni abilitate può essere eseguita. La scelta di quale transizione venga eseguita è fatta in maniera non deterministica (random).

### Eventi atomici vs nonatomici

L'occorrenza di eventi primitivi è istantanea: eventi non primitivi (con una durata) devono essere modellati da multipli eventi, ad esempio attività con eventi di inizio e di fine.

### Gerarchie 

- Supporto naturale alla modellazione di gerarchie: 
	- **astrazione** un'intera rete può essere rimpiazzata da un singolo posto o transizione per modellare ad un livello più astratto
	- **rifinimento**: posti e transizioni possono essere rimpiazzati da sottoreti per fornire una modellazione più dettagliata.

### Applicazioni alla progettazione concorrente e programmazione

Le RdP possono essere utilizzate per modellare sistemi software, in particolare quelli concorrenti, per:

- Rappresentare problemi
	- problemi di CS e Mutex
	- sincronizzazione 
- Rappresentare il comportamento di meccanismi
	- semafori
	- sincronizzatori 
- Rappresentare interi problemi
	- produttore / consumatore
	- lettori / scrittori
	- filosofi a cena

#### Problemi di CS e mutex

Vedi slide

#### Sincronizzazione

Si impone un ordine tra le azioni dei processi, rappresentate tramite transizioni e relazionando le azioni (transizioni) tramite le condizioni (posti)

Vedi slide

#### Semafori

- Semafori modellati come risorsa condivisa (posti)
	- **wait(P)** modellato come transizione dove il risultato del semaforo è il posto in input
	- **signal(Q)** modellato come transizione dove il risultato del semaforo è il posto in output

#### Produttori e consumatori

Vedi slide

#### Lettori e scrittori

Gli $n$ token in $p_1$ rappresentano $n$ processi che possono voler leggere o scrivere in una memoria condivisa rappresentata da $p_3$.

Vedi slide

#### Filosofi a cena

Le forchette sono rappresentate dai posti $a_i$. I filosofi pensano nei posti $A_t, B_t, C_t, D_t, E_t$ e mangiano nei posti $A_e, B_e, C_e, D_e, E_e$.

### Reti di Petri estese con archi inibitori

Estensione zero-testing: si estendono le RdP base con la possibilità di eseguire una transizione solo se certi posti hanno zero token. Gli **archi inibitori** sono rappresentati da archi con un piccolo cerchio alla fine.

RdP + Archi inibitori = Turing-equivalente: problemi di espressività e indecidibili.

### Descrizioni formali di Reti di Petri

Le RdP possono essere formalmente descritte per abilitare un'analisi rigorosa delle proprietà e dei problemi del sistema modellato:

- **proprietà strutturali**, indipendenti dalle marcature iniziali
- **proprietà comportamentali**, dipendente dalle marcature

Mappando la correttezza del sistema su proprietà strutturali/comportamentali - proprietà di sicurezza e vitalità.

#### Struttura delle Reti di Petri

- Può essere descritta dalla tupla $C = (P,T,I,O)$.
	- P = insieme di posti
	- T = insieme di transizioni
	- I = funzione di input, definisce l'insieme di posti di input per ogni transizione $t_j$
	- O = funzione di output, definisce l'insieme di posti di output per ogni transizione $t_j$

**Esempio**

```
P = { p1, p2, p3, p4, p5 }T = { t1, t2, t3, t4 }

I(t1) = {p1}I(t2) = {p2,p3,p5}I(t3) = {p3}I(t4) = {p4}
O(t1) = {p2,p3,p5}O(t2) = {p5}O(t3) = {p4}O(t4) = {p2,p3}

``` 

#### Marcatori

Un marcatore è un'assegnazione di token ai posti della rete. Può essere rappresentata formalmente come:

- un vettore di $N$ elementi, uno per posto, rappresentanti il numero di token per ogni posto
- una funzione $\mu : P \rightarrow N$, $\mu(p_i)$ = numero di token nel posto $p_i$

Una RdP marcata è rappresentata dalla 5-tupla $M = (P,T,I,O,\mu)$

#### Semantica di esecuzione delle regole

- Lo stato di una RdP è definito dai suoi marcatori. L'esecuzione di una transizione rappresenta un cambiamento in uno stato della rete
- **Funzione parziale prossimo-stato** $\delta(\mu, t_j)$: la funzione è indefinita se la transizione non è abilitata alla marcatura. Se $t_j$ è abilitata, $\mu ' = \delta(\mu, t_j)$ è la marcatura che risulta dalla rimozione dei token dall'input di $t_j$ e aggiungendo token all'output di $t_j$.
- Data una RdP e un marcatore iniziale, possiamo eseguire la RdP tramite successive esecuzioni di transizioni
	- Eseguire una transizione $t_j$ in un marcatore iniziale produce un nuovo marcatore $\mu^1 = \delta(\mu^0, t_j)$
	- In questo nuovo marcatore possiamo eseguire qualsiasi nuova transizione abilitata, chiamiamola $t_k$, risultante in un nuovo marcatore $\mu^2 = \delta(\mu^1, t_k)$
	- Ciò può continuare finchè c'è almeno una transizione abilitata in ogni marcatore
	- Se raggiungiamo un marcatore dove nessuna transizione è abilitata, allora nessuna transizione può essere eseguita e la RdP deve fermarsi.
- **Nondeterminismo**
	- Sequenze multiple di marcatori $(\mu^0, \mu^1, \mu^2...)$ e le relative transizioni $(t^0_j, t^1_j, t^2_j ...)$ possono risultare dall'esecuzione di una RdP  

### Insieme raggiungibile

- **Marcatori immediatamente raggiungibili**: un marcatore $m'$ è immediatamente raggiungibile da $m$ se possiamo eseguire qualche transizione abilitata in $m$ risultante in $m'$.
- **Marcatori raggiungibili**: un marcatore $m'$ è raggiungibile da $m$ se è immediatamente raggiungibile da $m$ o è raggiungibile da qualsiasi marcatore $m''$ che è immediatamente raggiungibile da $m'$.
- **Insieme raggiungibile di una RdP**: insieme di tutti gli stati in cui la RdP può entrare in una qualsiasi esecuzione

### Rappresentazone matriciale

- I componenti di una RdP possono essere convenientemente rappresentati come matrici:
	- matrice $m \times n$, $m$ righe = transizioni, $n$ colonne = posti
	- **input**: matrice $D-$. Elemento $D-[i,j]$ = peso dell'arco che connette $p_j$ con la transizione $t_i$.
	- **output**: matrice $D+$. Elemento $D+[i,j]$ = peso dell'arco che connette $t_i$ con la transizione $p_j$.
	- **incidente**: matrice $D = D+ - D-$
	- **transizione**: matrice $T$ di dimensione $(1 \times m)$ rappresentante l'esecuzione della RdP
	- **marcatore corrente**: matrice $M$ di dimensione $(1 \times n)$ rappresentante il numero corrente di token a posto
- Per calcolare l'evoluzione di una RdP: $M' = T \times D + M$

### Analisi dei modelli di RdP

- **reti sicure**: reti di Petri in cui non più di un token può mai essere in un qualsiasi posto nella rete allo stesso tempo. Giustificazioni basate sulla definizione originale di eventi e condizioni.
- **reti delimitate o k-reti delimitate**: reti in cui il numero di token in qualsiasi posto è limitato da $k$. Le reti sicure sono 1-rete delimitata. La delimitazione è una proprietà pratica molto importante.
- **reti conservative**: una RdP è conservativa se il numero di token nella rete è conservato.

### Vitalità

- Basata su **analisi delle transizioni**
	- **transizioni morte** in una marcatura, se non c'è sequenza di transizioni che possano abilitarla (deadlock)
	- **potenzialmente eseguibile**, se non esiste qualche sequenza che la abilita (starvation)
	- **transizione viva** eseguibile in tutti i marcatori raggiungibili
- Per la vitalità, è importante non solo che una transizione sia eseguibile in un dato marcatore, ma rimangono potenzialmente eseguibili in tutti i marcatori raggiungibili per quel marcatore

### Estensioni di RdP

- **Reti temporizzate**
	- reti temporizzate deterministiche
	- **Reti stocastiche**
- **Reti ad alto livello**
	- **Reti colorate** 










## Diagrammi a stati

## Diagrammi di attività